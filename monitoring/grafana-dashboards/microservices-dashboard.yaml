apiVersion: v1
kind: ConfigMap
metadata:
  name: microservices-dashboard
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  microservices.json: |
    {
      "dashboard": {
        "title": "Microservices Overview",
        "panels": [
          {
            "title": "Request Rate",
            "targets": [{"expr": "rate(http_server_requests_seconds_count[5m])"}]
          },
          {
            "title": "Error Rate",
            "targets": [{"expr": "rate(http_server_requests_seconds_count{status=~\"5..\"}[5m])"}]
          },
          {
            "title": "Response Time (p95)",
            "targets": [{"expr": "histogram_quantile(0.95, rate(http_server_requests_seconds_bucket[5m]))"}]
          },
          {
            "title": "CPU Usage",
            "targets": [{"expr": "rate(container_cpu_usage_seconds_total{namespace=~\"dev|prod\"}[5m])"}]
          },
          {
            "title": "Memory Usage",
            "targets": [{"expr": "container_memory_usage_bytes{namespace=~\"dev|prod\"}"}]
          }
        ]
      }
    }
